(()=>{"use strict";var e=function(e){if(e){e.classList.add("popup_is-animated");var t=e.querySelector(".popup__close");t&&t.addEventListener("click",(function(){return o(e)})),e.addEventListener("click",(function(t){t.target===e&&o(e)}))}};function t(e,t){e&&(t&&"function"==typeof t&&t(),e.classList.add("popup_is-opened"),document.addEventListener("keydown",r))}function o(e){e&&(e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r))}function r(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&o(t)}}var n={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-41",headers:{authorization:"67a7900a-684d-4cee-aa4e-bccd787c4e38","Content-Type":"application/json"}};function c(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var i=function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then(c)},a=function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then(c)},l=document.querySelector("#card-template").content.querySelector(".places__item");function u(e){var t=e.cardData,o=e.onDelete,r=e.onClick,n=e.onLike,c=e.isLiked,u=void 0!==c&&c,s=e.likeCount,d=void 0===s?0:s,p=l.cloneNode(!0),f=p.querySelector(".card__image"),y=p.querySelector(".card__title"),m=p.querySelector(".card__delete-button"),v=p.querySelector(".card__like-button"),_=p.querySelector(".card__like-count");return y.textContent=t.name,f.src=t.link,f.alt=t.name,_.textContent=d,u&&v.classList.add("card__like-button_is-active"),o?m.addEventListener("click",(function(){return o(t._id,p)})):m.remove(),v.addEventListener("click",(function(){if(n){var e=v.classList.contains("card__like-button_is-active");(function(e,t){return(t?a:i)(e).then((function(e){return{isLiked:!t,likesCount:e.likes.length}}))})(t._id,e).then((function(e){var o=e.isLiked,r=e.likesCount;v.classList.toggle("card__like-button_is-active",o),_.textContent=r,n(t._id,o)})).catch((function(e){return console.error("Ошибка при обновлении лайка:",e)}))}})),f.addEventListener("click",(function(){r&&r(t.name,t.link)})),p}function s(e,t,o){if(console.log("checkInputValidity called for:",t.name,"value:",t.value),t.setCustomValidity(""),t.validity.valueMissing)return console.log("Field is required"),void("true"===t.dataset.touched?d(e,t,"Вы пропустили это поле.",o):p(e,t,o));if("url"===t.type&&t.validity.typeMismatch)return console.log("URL validation failed"),void d(e,t,t.dataset.errorMessage||"Введите корректный URL",o);if(t.dataset.pattern&&"url"!==t.type&&t.value){console.log("Checking pattern for:",t.value);var r=/[^A-Za-zА-Яа-яЁё\s\-]/.test(t.value);if(console.log("Has invalid chars:",r),r){var n=t.dataset.errorMessage||"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";return console.log("Showing error:",n),void d(e,t,n,o)}}return t.validity.tooShort&&"url"!==t.type?(console.log("Too short"),void d(e,t,"Минимальная длина: ".concat(t.minLength," симв."),o)):t.validity.tooLong&&"url"!==t.type?(console.log("Too long"),void d(e,t,"Максимальная длина: ".concat(t.maxLength," симв."),o)):(console.log("No errors, hiding error"),p(e,t,o),void t.setCustomValidity(""))}function d(e,t,o,r){var n=e.querySelector("#".concat(t.id,"-error"));console.log("showInputError called",{inputId:t.id,errorElement:n,errorMessage:o}),n?(t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass),console.log("Error shown:",o)):console.error("Error element not found for input:",t.id)}function p(e,t,o){var r=e.querySelector("#".concat(t.id,"-error"));r&&(t.classList.remove(o.inputErrorClass),r.textContent="",r.classList.remove(o.errorClass))}function f(e,t,o){e.checkValidity()?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))}function y(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach((function(o){o.dataset.touched="false",p(e,o,t),o.setCustomValidity("")})),f(e,r,t)}function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function v(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function _(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?v(Object(o),!0).forEach((function(t){h(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):v(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function h(e,t,o){return(t=function(e){var t=function(e){if("object"!=m(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=m(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==m(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=Array(t);o<t;o++)r[o]=e[o];return r}function g(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранить";e.textContent=t?o:r,e.disabled=t,t?e.classList.add("popup__button_loading"):e.classList.remove("popup__button_loading")}var S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){console.log("Enabling validation with settings:",e);var t=Array.from(document.querySelectorAll(e.formSelector));console.log("Found forms:",t),t.forEach((function(t){console.log("Setting up validation for form:",t),function(e,t){console.log("Setting up form validation for:",e);var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);console.log("Found inputs:",o),console.log("Submit button:",r),o.forEach((function(o){o.addEventListener("blur",(function(){o.dataset.touched="true",s(e,o,t),f(e,r,t)})),o.addEventListener("input",(function(){s(e,o,t),f(e,r,t)}))})),f(e,r,t),console.log("Form validation setup complete for:",e)}(t,e)}))}(S);var k=document.querySelector('[name="edit-profile"]'),L=k.querySelector(".popup__input_type_name"),q=k.querySelector(".popup__input_type_description"),E=document.querySelector('[name="new-place"]'),C=E.querySelector(".popup__input_type_card-name"),O=E.querySelector(".popup__input_type_url"),w=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_image"),A=P.querySelector(".popup__image"),U=P.querySelector(".popup__caption"),D=document.querySelector(".places__list"),T=document.querySelector(".profile__add-button"),I=document.querySelector(".popup_type_new-card"),B=document.querySelector(".profile__edit-button"),M=document.querySelector(".popup_type_edit"),V=document.querySelector(".popup_type_confirm"),F=null;function N(e,t){var o=e.owner._id===t,r=e.likes.some((function(e){return e._id===t}));return u({cardData:_(_({},e),{},{likes:e.likes||[]}),onDelete:o?R:null,onLike:H,onClick:J,isLiked:r,likeCount:e.likes.length})}function R(e,r){t(V,null),V.querySelector(".popup__form").onsubmit=function(t){t.preventDefault(),function(e){return fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then(c)}(e).then((function(){r.remove(),o(V)})).catch((function(e){return console.error("Ошибка при удалении карточки:",e)}))}}function H(e,t){console.log("Лайк для карточки ".concat(e," обновлен. Новое состояние: ").concat(t?"лайкнуто":"не лайкнуто"))}function J(e,o){A.src=o,A.alt=e,U.textContent=e,t(P,null)}Promise.all([fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then(c),fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then(c)]).then((function(e){var t,o,r=(o=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var r,n,c,i,a=[],l=!0,u=!1;try{if(c=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;l=!1}else for(;!(l=(r=c.call(o)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){u=!0,n=e}finally{try{if(!l&&null!=o.return&&(i=o.return(),Object(i)!==i))return}finally{if(u)throw n}}return a}}(t,o)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?b(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=r[0],c=r[1];F=n._id,w.textContent=n.name,j.textContent=n.about,x.style.backgroundImage="url(".concat(n.avatar,")"),D.innerHTML="",c.forEach((function(e){D.append(N(e,F))}))})).catch((function(e){console.error("Ошибка при загрузке данных:",e)})),e(),T.addEventListener("click",(function(){!function(){if(E){E.reset(),y(E,S);var e=E.querySelectorAll(S.inputSelector);e.forEach((function(e){s(E,e,S)}));var t=e[0];t&&setTimeout((function(){return t.focus()}),100)}}(),t(I)})),B.addEventListener("click",(function(){var e,o;e=w.textContent,o=j.textContent,L.value=e||"",q.value=o||"",y(k,S),t(M)})),E.addEventListener("submit",(function(e){e.preventDefault();var t,r,i=e.submitter||e.target.querySelector(".popup__button"),a=i.textContent;E.checkValidity()&&(g(i,!0,"Создание...",a),(t=C.value,r=O.value,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:t,link:r})}).then(c)).then((function(e){var t=N(e,F);D.prepend(t),o(I)})).catch((function(e){return console.error("Ошибка при добавлении карточки:",e)})).finally((function(){g(i,!1,"Создание...",a)})))})),k.addEventListener("submit",(function(e){e.preventDefault();var t,r,i=e.submitter||e.target.querySelector(".popup__button"),a=i.textContent;g(i,!0,"Сохранение...",a),(t=L.value,r=q.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:t,about:r})}).then(c)).then((function(e){w.textContent=e.name,j.textContent=e.about,o(M)})).catch((function(e){return console.error("Ошибка при обновлении профиля:",e)})).finally((function(){g(i,!1,"Сохранение...",a)}))})),document.querySelectorAll(".popup").forEach((function(t){e(t)}));var z=document.querySelector(".popup_type_avatar"),Z=document.forms["edit-avatar"],$=Z?Z.querySelector(".popup__input_type_url"):null,G=document.querySelector(".profile__image-edit-button");console.log("profileImage:",x),console.log("profileImageEditButton:",G),console.log("avatarForm:",Z),console.log("avatarUrlInput:",$),console.log("avatarPopup:",z),G&&Z&&$&&z?G.addEventListener("click",(function(){console.log("Клик по кнопке редактирования аватара"),Z.reset(),y(Z,S),t(z)})):console.error("Не удалось найти необходимые элементы для работы с аватаром"),Z?Z.addEventListener("submit",(function(e){e.preventDefault(),console.log("Отправка формы аватара");var t=e.submitter||Z.querySelector(".popup__button");if(t){var r=$.value.trim();if(r){console.log("Попытка обновить аватар на URL:",r);var i,a=t.textContent;g(t,!0,"Сохранение...",a),(i=r,fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:i})}).then(c)).then((function(e){console.log("Аватар успешно обновлен:",e),x?x.style.backgroundImage="url(".concat(e.avatar,")"):console.error("Не найден элемент для отображения аватара"),o(z)})).catch((function(e){console.error("Ошибка при обновлении аватара:",e);var t=Z.querySelector(".popup__error");t&&(t.textContent="Не удалось обновить аватар. Проверьте URL и попробуйте снова.",t.style.display="block")})).finally((function(){g(t,!1,"Сохранение...",a)}))}else console.error("URL аватара не может быть пустым")}else console.error("Не найдена кнопка отправки формы")})):console.error("Форма аватара не найдена")})();