(()=>{"use strict";var e=function(e){if(e){e.classList.add("popup_is-animated");var t=e.querySelector(".popup__close");t&&t.addEventListener("click",function(){return o(e)}),e.addEventListener("click",function(t){t.target===e&&o(e)})}};function t(e,t){e&&(t&&"function"==typeof t&&t(),e.classList.add("popup_is-opened"),document.addEventListener("keydown",r))}function o(e){e&&(e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r))}function r(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&o(t)}}var n=document.querySelector("#card-template").content.querySelector(".places__item");function c(e){console.log("Enabling validation with settings:",e);var t=Array.from(document.querySelectorAll(e.formSelector));console.log("Found forms:",t),t.forEach(function(t){console.log("Setting up validation for form:",t),function(e,t){console.log("Setting up form validation for:",e);var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);console.log("Found inputs:",o),console.log("Submit button:",r),o.forEach(function(o){o.addEventListener("blur",function(){o.dataset.touched="true",i(e,o,t),u(e,r,t)}),o.addEventListener("input",function(){i(e,o,t),u(e,r,t)})}),u(e,r,t),console.log("Form validation setup complete for:",e)}(t,e)})}function i(e,t,o){if(console.log("checkInputValidity called for:",t.name,"value:",t.value),t.setCustomValidity(""),t.validity.valueMissing)return console.log("Field is required"),void("true"===t.dataset.touched?a(e,t,"Вы пропустили это поле.",o):l(e,t,o));if("url"===t.type&&t.validity.typeMismatch)return console.log("URL validation failed"),void a(e,t,t.dataset.errorMessage||"Введите корректный URL",o);if(t.dataset.pattern&&"url"!==t.type&&t.value){console.log("Checking pattern for:",t.value);var r=/[^A-Za-zА-Яа-яЁё\s\-]/.test(t.value);if(console.log("Has invalid chars:",r),r){var n=t.dataset.errorMessage||"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";return console.log("Showing error:",n),void a(e,t,n,o)}}return t.validity.tooShort&&"url"!==t.type?(console.log("Too short"),void a(e,t,"Минимальная длина: ".concat(t.minLength," симв."),o)):t.validity.tooLong&&"url"!==t.type?(console.log("Too long"),void a(e,t,"Максимальная длина: ".concat(t.maxLength," симв."),o)):(console.log("No errors, hiding error"),l(e,t,o),void t.setCustomValidity(""))}function a(e,t,o,r){var n=e.querySelector("#".concat(t.id,"-error"));console.log("showInputError called",{inputId:t.id,errorElement:n,errorMessage:o}),n?(t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass),console.log("Error shown:",o)):console.error("Error element not found for input:",t.id)}function l(e,t,o){var r=e.querySelector("#".concat(t.id,"-error"));r&&(t.classList.remove(o.inputErrorClass),r.textContent="",r.classList.remove(o.errorClass))}function u(e,t,o){e.checkValidity()?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))}function s(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(function(o){o.dataset.touched="false",l(e,o,t),o.setCustomValidity("")}),u(e,r,t)}var d={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-41",headers:{authorization:"67a7900a-684d-4cee-aa4e-bccd787c4e38","Content-Type":"application/json"}};function p(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var f=function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:d.headers}).then(p)},y=function(e){return fetch("".concat(d.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:d.headers}).then(p)};function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function v(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,r)}return o}function _(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?v(Object(o),!0).forEach(function(t){h(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):v(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function h(e,t,o){return(t=function(e){var t=function(e){if("object"!=m(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=m(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==m(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=Array(t);o<t;o++)r[o]=e[o];return r}var S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};c(S);var g=document.querySelector('[name="edit-profile"]'),q=g.querySelector(".popup__input_type_name"),C=g.querySelector(".popup__input_type_description"),k=document.querySelector('[name="new-place"]'),E=k.querySelector(".popup__input_type_card-name"),L=k.querySelector(".popup__input_type_url"),O=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),w=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_image"),A=j.querySelector(".popup__image"),P=j.querySelector(".popup__caption"),U=document.querySelector(".places__list"),D=document.querySelector(".profile__add-button"),T=document.querySelector(".popup_type_new-card"),I=document.querySelector(".profile__edit-button"),B=document.querySelector(".popup_type_edit"),M=document.querySelector(".popup_type_confirm"),V=null;function F(e,t){var o=e.owner._id===t,r=e.likes.some(function(e){return e._id===t}),c=function(e){var t=e.cardData,o=e.onDelete,r=e.onClick,c=e.onLike,i=e.isLiked,a=void 0!==i&&i,l=e.likeCount,u=void 0===l?0:l,s=n.cloneNode(!0),d=s.querySelector(".card__image"),p=s.querySelector(".card__title"),f=s.querySelector(".card__delete-button"),y=s.querySelector(".card__like-button"),m=s.querySelector(".card__like-count");return s.dataset.cardId=t._id,p.textContent=t.name,d.src=t.link,d.alt=t.name,m.textContent=u,a&&y.classList.add("card__like-button_is-active"),o?f.addEventListener("click",function(){return o(t._id)}):f.remove(),y.addEventListener("click",function(){if(c){var e=y.classList.contains("card__like-button_is-active");c(t._id,e)}}),d.addEventListener("click",function(){r&&r(t.name,t.link)}),s}({cardData:_(_({},e),{},{likes:e.likes.length}),onDelete:o?N:null,onClick:H,onLike:R,isLiked:r,likeCount:e.likes.length});U.prepend(c)}function N(e){t(M,null),M.querySelector(".popup__form").onsubmit=function(t){t.preventDefault(),function(e){return fetch("".concat(d.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:d.headers}).then(p)}(e).then(function(){document.querySelector('[data-card-id="'.concat(e,'"]')).remove(),o(M)}).catch(function(e){return console.error("Ошибка при удалении карточки:",e)})}}function R(e,t){(t?y:f)(e).then(function(o){var r=document.querySelector('[data-card-id="'.concat(e,'"]')),n=r.querySelector(".card__like-button"),c=r.querySelector(".card__like-count");n.classList.toggle("card__like-button_is-active",!t),c.textContent=o.likes.length}).catch(function(e){return console.error("Ошибка при обновлении лайка:",e)})}function H(e,o){A.src=o,A.alt=e,P.textContent=e,t(j,null)}Promise.all([fetch("".concat(d.baseUrl,"/users/me"),{headers:d.headers}).then(p),fetch("".concat(d.baseUrl,"/cards"),{headers:d.headers}).then(p)]).then(function(e){var t,o,r=(o=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var r,n,c,i,a=[],l=!0,u=!1;try{if(c=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;l=!1}else for(;!(l=(r=c.call(o)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){u=!0,n=e}finally{try{if(!l&&null!=o.return&&(i=o.return(),Object(i)!==i))return}finally{if(u)throw n}}return a}}(t,o)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?b(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=r[0],c=r[1];V=n._id,O.textContent=n.name,x.textContent=n.about,w.style.backgroundImage="url(".concat(n.avatar,")"),U.innerHTML="",c.forEach(function(e){U.append(F(e,V))})}).catch(function(e){console.error("Ошибка при загрузке данных:",e)}),e(),D.addEventListener("click",function(){!function(){if(k){k.reset(),s(k,S);var e=k.querySelectorAll(S.inputSelector);e.forEach(function(e){i(k,e,S)});var t=e[0];t&&setTimeout(function(){return t.focus()},100)}}(),t(T)}),I.addEventListener("click",function(){!function(){var e=O.textContent,t=x.textContent;q.value=e||"",C.value=t||"",s(g,S);var o=e&&t,r=g.querySelector(S.submitButtonSelector);r&&(r.disabled=!o,r.classList.toggle(S.inactiveButtonClass,!o))}(),t(B)}),k.addEventListener("submit",function(e){e.preventDefault();var t,r,n=e.target.querySelector(".popup__button"),c=n.textContent;k.checkValidity()&&(n.textContent="Создание...",(t=E.value,r=L.value,fetch("".concat(d.baseUrl,"/cards"),{method:"POST",headers:d.headers,body:JSON.stringify({name:t,link:r})}).then(p)).then(function(e){F(e,V),o(T)}).catch(function(e){return console.error("Ошибка при добавлении карточки:",e)}).finally(function(){n.textContent=c}))}),g.addEventListener("submit",function(e){e.preventDefault();var t,r,n=e.target.querySelector(".popup__button"),c=n.textContent;n.textContent="Сохранение...",(t=q.value,r=C.value,fetch("".concat(d.baseUrl,"/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:t,about:r})}).then(p)).then(function(e){O.textContent=e.name,x.textContent=e.about,o(B)}).catch(function(e){return console.error("Ошибка при обновлении профиля:",e)}).finally(function(){n.textContent=c})}),document.querySelectorAll(".popup").forEach(function(t){e(t)});var J=document.querySelector(".popup_type_avatar"),z=document.forms["edit-avatar"],Z=z?z.querySelector(".popup__input_type_url"):null,$=document.querySelector(".profile__image-edit-button");z&&c({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),console.log("profileImage:",w),console.log("profileImageEditButton:",$),console.log("avatarForm:",z),console.log("avatarUrlInput:",Z),console.log("avatarPopup:",J),$&&z&&Z&&J?$.addEventListener("click",function(){console.log("Клик по кнопке редактирования аватара"),z.reset(),s(z,S),z.querySelectorAll(S.inputSelector).forEach(function(e){e.dataset.touched="false"}),t(J)}):console.error("Не удалось найти необходимые элементы для работы с аватаром"),z?z.addEventListener("submit",function(e){e.preventDefault(),console.log("Отправка формы аватара");var t=z.querySelector(".popup__button");if(t){var r,n=Z.value.trim();n?(console.log("Попытка обновить аватар на URL:",n),t.textContent="Сохранение...",(r=n,fetch("".concat(d.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:r})}).then(p)).then(function(e){console.log("Аватар успешно обновлен:",e),w?w.style.backgroundImage="url(".concat(e.avatar,")"):console.error("Не найден элемент для отображения аватара"),o(J)}).catch(function(e){console.error("Ошибка при обновлении аватара:",e);var t=z.querySelector(".popup__error");t&&(t.textContent="Не удалось обновить аватар. Проверьте URL и попробуйте снова.",t.style.display="block")}).finally(function(){t&&(t.textContent="Сохранить")})):console.error("URL аватара не может быть пустым")}else console.error("Не найдена кнопка отправки формы")}):console.error("Форма аватара не найдена")})();